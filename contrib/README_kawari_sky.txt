
華和梨20010914-sky

-----------------------------------------------------------------------------
09/14/2001

sky / もしくは酔狂です。

このパッケージはMesiter氏開発による
「"華和梨" for あれ以外の何か以外の何か」 Phase 7.0
に対するバグフィックスを行ったものです。

週明け以降、本家「あれ以外の何か以外の何かプロジェクト」からも同等品が
出ると思われます。


-----------------------------------------------------------------------------
[ パッケージ内容 ]

  shiori-20010914-sky.dll      華和梨
  kosui-20010914-sky.exe       幸水
  README_kawari_sky.txt        このドキュメント
  kawari-20010914-sky.patch    パッチ from 本家Phase 7.0
  readme.html                  オリジナルに付属のドキュメント
  + document /                 さとー氏作成、ベータ版Phase 7.0ドキュメント


-----------------------------------------------------------------------------
[ 20010914変更点 ]

・3項以上のAND検索に関するバグフィックス

  ${entry1 & entry2}式のAND検索型エントリ呼び出しにおいて、3項目以降のエントリ
指定が無視されていた問題をフィックス。


-----------------------------------------------------------------------------
[ 20010907変更点 ]

・セキュリティパッチ。驚愕のredo34変更点に対応。

  SHIORIは、詐称可能なSenderやEventヘッダに頼ることなく、全てのイベントの
伝達経路を知る必要がある。詳しくは語らないが、SSTPを通じて外部から悪意ある
イベントコードを送ることにより、システムに致命的な被害を与えることが可能だ
からである。

  セキュリティ対策として、redo20時点で、本家は以下のような仕様を定めた。

＞■EMBRYO - 全 SHIORI リクエストに Sender ヘッダ付加。
＞Sender: embryo
＞というより仕様書ではずっと前から付いていたので、付いていないことの方が異
＞常。

＞■EMBRYO - SSTP Notify によってローカルマシン外で発生したイベントの 
＞Sender を External と定義。
＞結局のところ誰も遊び方を思いつかないので要するに External をブロックする
＞だけの内容になると思います。

  そこで華和梨 Phase 7.0では、Senderの値からイベント処理の続行を判断するス
テップを設けた。判断基準は以下の通りであった。

  level 4: "embryo"のみ許可
  level 3: "External"、Sender不明以外を許可 (つまり、名乗っているDirectSSTP
           は通す)
  level 2: "External"以外を許可(名乗っていないDirectSSTPを通す)
  level 1: (level2と同様)
  level 0: 全て許可

  これに対しredo34において、本家は新たな仕様を定めた。

＞■EMBRYO - SSTP NOTIFY によるイベント通知が全て Sender: External になる
＞問題を修正。そもそもSSTP NOTIFY の Sender をセットするのが妥当と思われる。
＞
＞Sender: 猫どりふ (local)
＞Sender: 猫どりふ (external)
＞
＞※実際の猫どりふイベントは Sender が落下物名。

  今回のパッチはこの仕様変更に伴うものである。
  今回の本家仕様変更によって、経路情報といわゆる'Sender'を分離することが可
能となった。従って、フィルタリングは経路情報のみに頼るものとした。
  判断は2ステップとなる。

STEP1:
  経路を決定する。

  SYSTEM  : "Sender: embryo"
  LOCAL   : (local)がついているもの
  UNKNOWN : "Sender: User"(コミュニケートボックス)など
  EXTERNAL: (external)がついているもの

  経路情報以外をsystem.Senderから削除。
  経路情報('system'/'local'/'external'/'unknown')をsystem.Sender.Pathに格納
(EXPERIMENTAL)。

STEP2:
  経路に基づいてフィルタリングする。

  level 4: SYSTEMのみ許可する
  level 3: SYSTEM, LOCALを許可する
  level 2: SYSTEM, LOCAL, UNKNOWNを許可する
  level 1: (level 2と同様)
  level 0: 全て許可する

  許可されなかった場合、400 Bad Requestが返る。NOTIFY/1.1の場合は"保険"
Sentenceが表示されることもある。


-----------------------------------------------------------------------------
[ 連絡先 ]
オフィシャル御三家(公式、「使い倒す」、「応援団」)の掲示板は全て見ています。
私のところの掲示板、メールでも構いません。
http://www.yk.rim.or.jp/~suikyo/
suikyo@yk.rim.or.jp

配布条件は修正BSDです。


-----------------------------------------------------------------------------
[ 謝辞 ]

場を提供していただいた華和梨開発者/ゴーストベンダの皆様、
upxを使わせて頂いているMarkus F.X.J. Oberhumerさん
# http://wildsau.dv.uni-linz.ac.at/mfx/
に感謝いたします。


